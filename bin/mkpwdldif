#! /usr/bin/python3

# take a DN and a password, and output the LDIF to change the AD
# password for that DN. If no password is passed on the command line
# one is prompted for

import base64
import sys
import getpass

if len(sys.argv) < 2 or len(sys.argv) > 3:
    print(f"Usage: {sys.argv[0]} dn [password]")
    sys.exit(1)

if len(sys.argv) == 2:
    pwd = getpass.getpass("New password: ")
else:
    pwd = sys.argv[2]


original_string='"' + pwd + '"'
utf16le_bytes = original_string.encode('utf-16-le')
encoded_bytes = base64.b64encode(utf16le_bytes)
encoded_string = encoded_bytes.decode('utf-8')

print("# change password with ldapmodify -f thisfile")
print(f"dn: {sys.argv[1]}")
print("changetype: modify")
print("replace: unicodePwd")
print(f"unicodePwd:: {encoded_string}")
